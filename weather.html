<!DOCTYPE html>
<html>

<head>
    <style>

    </style>
</head>

<body>
    Ville <input id="city" value="Blainville" />
    <button onclick="getForecast();">Prévisions</button>
    <div id="curve_chart" style="width: 100%; height: 600px; margin:auto"></div>
</body>
<script src="jquery/jquery-3.4.1.min.js"></script>
<script src="https://www.gstatic.com/charts/loader.js"></script>
<script>
    $(document).ready(init_UI)
    let startDate = null;
    let endDate = null;
    let API_Key = "votre clé API";
    function twoDigit(v) {
        if (v < 10) return '0' + v;
        return v;
    }
    function DateToString(date) {
        return date.getFullYear() + '-' + twoDigit(date.getMonth() + 1) + '-' + twoDigit(date.getDate());
    }
    function init_UI() {
        google.charts.load('current', { packages: ['corechart'], language: 'fr' });
        google.charts.setOnLoadCallback(getForecast);
        $(window).resize(function () {
            showForecast();
        });
    }

    let city;
    let forecast;

    function showForecast() {
        var options = {
            title: city + ' - prévisions 14 jours',
            titleTextStyle: { fontSize: '32', color: 'green' },
            vAxis: { title: 'Celcius' },
            hAxis: { format: 'MM-dd' },
            series: { 0: { lineWidth: 4 }, 1: { lineWidth: 4 } },
            legend: { position: 'top' }
        };
        var data = google.visualization.arrayToDataTable(forecast);
        var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
        //https://developers.google.com/chart/interactive/docs/reference#dateformatter
        var dateFormat = new google.visualization.DateFormat({ pattern: "d MMMM yyyy" });
        var tempFormat = new google.visualization.NumberFormat({ suffix: '°', fractionDigits: 0 });
        // reformat column #0 
        dateFormat.format(data, 0);
        tempFormat.format(data, 1);
        tempFormat.format(data, 2);
        chart.draw(data, options);
    }

    function toJavaScriptDate(val) {
        return new Date(val * 1000);
    }

    function getForecast() {
        forecast = [];
        city = document.getElementById("city").value;
        let url = "https://api.openweathermap.org/data/2.5/forecast/daily?units=metric&q=" + city + "&cnt=15&appid=" + API_Key;
        console.log(url);
        $.ajax({
            url: url,
            success: (data) => {
                for (let d = 0; d < data.list.length; d++) {
                    forecast.push([toJavaScriptDate(data.list[d].dt), Math.round(data.list[d].temp.min), Math.round(data.list[d].temp.max)]);
                }
                forecast.unshift(['Date', 'MIN', 'MAX']);
                showForecast();
            },
            error: () => {
                document.getElementById('curve_chart').innerHTML = "<h3>Ville introuvable, spécifiez la province et le pays</h3>";
            }
        })
    }
</script>

</html>